<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>æ±‚æ´</title>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #f9fafb;
}

.header {
  height: 70px;
  padding: 0 40px;
  background-color: #ffffff;
  display: flex;
  justify-content: space-between;
  align-items: center;
  border-bottom: 1px solid #e5e7eb;
}

.logo {
  font-size: 24px;
  font-weight: 700;
  color: #0f172a;
}

.dot {
  color: #2563eb;
}

.header-right {
  display: flex;
  align-items: center;
  gap: 20px;
  font-size: 14px;
}

.points {
  color: #2563eb;
  font-weight: 600;
}

.nickname {
  color: #374151;
}

.logout {
  cursor: pointer;
  padding: 6px 10px;
  border-radius: 6px;
  background: #f3f4f6;
}

.logout:hover {
  background: #e5e7eb;
}

.layout {
  display: flex;
  min-height: calc(100vh - 70px);
}

.sidebar {
  width: 220px;
  background: #ffffff;
  border-right: 1px solid #e5e7eb;
  padding-top: 20px;
}

.menu-item {
  padding: 15px 20px;
  cursor: pointer;
  color: #374151;
}

.menu-item:hover {
  background: #f3f4f6;
}

.main {
  flex: 1;
  padding: 30px;
}

.banner {
  background: #2563eb;
  color: white;
  padding: 20px;
  border-radius: 10px;
  margin-bottom: 20px;
}

.notice {
  background: white;
  padding: 15px;
  border-radius: 10px;
  margin-bottom: 20px;
  border: 1px solid #e5e7eb;
}

.card {
  background: white;
  padding: 15px;
  border-radius: 10px;
  margin-bottom: 15px;
  border: 1px solid #e5e7eb;
}

.card-title {
  font-weight: bold;
  margin-bottom: 8px;
}

.card-meta {
  font-size: 12px;
  color: gray;
}
</style>
</head>

<body>

<header class="header">
  <div class="logo">
    æ±‚æ´<span class="dot">.</span>
  </div>

  <div class="header-right">
    <div class="points">0P</div>
    <div class="nickname">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
    <div class="logout">ë¡œê·¸ì•„ì›ƒ</div>
  </div>
</header>

<div class="layout">

  <div class="sidebar">
    <div class="menu-item">ğŸ“„ ë¬¸ë‹µ</div>
    <div class="menu-item">ğŸ† ë­í‚¹</div>
    <div class="menu-item">ğŸ’° í¬ì¸íŠ¸ ê´€ë¦¬</div>
    <div class="menu-item">ğŸ‘¤ ë§ˆì´í˜ì´ì§€</div>
  </div>

  <div class="main">

    <div class="banner">
      ğŸ“¢ ì´ë²ˆ ì£¼ ì§ˆë¬¸ ì´ë²¤íŠ¸ ì§„í–‰ ì¤‘!
    </div>

    <div class="notice">
      <b>ê³µì§€</b><br>
      - ë¹„ì†ì–´ ì‚¬ìš© ê¸ˆì§€<br>
      - í•™ë²ˆ ê³µê°œ ê¸ˆì§€
    </div>

<!-- ğŸ”¥ ì§ˆë¬¸ ì‘ì„± ë°•ìŠ¤ -->
<div class="card">
  <input 
    type="text" 
    id="questionInput"
    placeholder="ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”"
    style="width: 75%; padding: 8px;"
  />
  <button 
    id="submitQuestion"
    style="padding: 8px 12px; margin-left: 10px;"
  >
    ë“±ë¡
  </button>
</div>
    
    <!-- ğŸ”¥ ì§ˆë¬¸ ë¦¬ìŠ¤íŠ¸ ì¶œë ¥ ì˜ì—­ -->
    <div id="questionList"></div>

  </div>

</div>

<script type="module">
  import { auth, db } from "./firebase.js";
  import { onAuthStateChanged, signOut }
    from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";
import { collection, getDocs, doc, getDoc, addDoc, deleteDoc }
from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";
  const nicknameEl = document.querySelector(".nickname");
  const pointsEl = document.querySelector(".points");
  const logoutBtn = document.querySelector(".logout");
  const questionList = document.getElementById("questionList");

  // ğŸ”¹ ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸
  onAuthStateChanged(auth, async (user) => {
    if (!user) {
      window.location.href = "/sbh_qna/login.html";
      return;
    }

    // ğŸ”¹ ìœ ì € ì •ë³´ ë¶ˆëŸ¬ì˜¤ê¸°
    const docRef = doc(db, "users", user.uid);
    const docSnap = await getDoc(docRef);

    if (docSnap.exists()) {
      const data = docSnap.data();
      nicknameEl.innerText = data.nickname;
      pointsEl.innerText = data.points + "P";
    }

    // ğŸ”¹ ì§ˆë¬¸ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
    loadQuestions();
  });

const input = document.getElementById("questionInput");
const submitBtn = document.getElementById("submitQuestion");

submitBtn.addEventListener("click", async () => {
  const title = input.value.trim();

  if (!title) {
    alert("ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”");
    return;
  }

  const user = auth.currentUser;

  if (!user) {
    alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
    return;
  }

await addDoc(collection(db, "questions"), {
  title: title,
  nickname: nicknameEl.innerText,
  answerCount: 0,
  uid: user.uid   // ğŸ”¥ ì¶”ê°€
});

  input.value = "";
  loadQuestions(); // ëª©ë¡ ë‹¤ì‹œ ë¶ˆëŸ¬ì˜¤ê¸°
});
  
  // ğŸ”¹ ì§ˆë¬¸ ë¶ˆëŸ¬ì˜¤ê¸° í•¨ìˆ˜
  async function loadQuestions() {
    const querySnapshot = await getDocs(collection(db, "questions"));

    questionList.innerHTML = "";

querySnapshot.forEach((doc) => {
  const data = doc.data();

  const card = document.createElement("div");
      card.className = "card";

card.innerHTML = `
  <div class="card-title">${data.title}</div>
  <div class="card-meta">
    ì‘ì„±ì: ${data.nickname} | ë‹µë³€ ${data.answerCount || 0}ê°œ
  </div>
`;

if (auth.currentUser && auth.currentUser.uid === data.uid) {
  const deleteBtn = document.createElement("button");
  deleteBtn.innerText = "ì‚­ì œ";
  deleteBtn.style.marginTop = "8px";
  deleteBtn.style.padding = "4px 8px";

  deleteBtn.addEventListener("click", async () => {
    await deleteDoc(doc(db, "questions", document.id));
    loadQuestions();
  });

  card.appendChild(deleteBtn);
}  

      questionList.appendChild(card);
    });
  }

  // ğŸ”¹ ë¡œê·¸ì•„ì›ƒ
  logoutBtn.addEventListener("click", async () => {
    await signOut(auth);
    window.location.href = "/sbh_qna/login.html";
  });
</script>

</body>
</html>


